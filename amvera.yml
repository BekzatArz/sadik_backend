---
version: null
meta:
  environment: python
  toolchain:
    name: pip
    version: 3.10.10
build:
  requirementsPath: requirements.txt
run:
  command: |
    echo "Checking if migrations directory exists"
    if [ ! -d "migrations" ]; then
        echo "Initializing migrations"
        flask db init
    else
        echo "Migrations directory already exists"
    fi
    echo "Stamping head"
    flask db stamp head
    echo "Creating migrations"
    flask db migrate -m "Auto migration"
    echo "Upgrading database"
    flask db upgrade
    echo "Starting Gunicorn"
    gunicorn --bind 0.0.0.0:5000 run:app
  persistenceMount: /data
  containerPort: 80
